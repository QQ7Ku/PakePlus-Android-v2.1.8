/**
 * ============================================
 * 移动端响应式适配增强
 * ============================================
 */

/* 大屏手机断点 (576px - 767px) */
@media (max-width: 767px) and (min-width: 576px) {
    .sidebar {
        max-height: 45vh;
    }
    
    .canvas-container {
        min-height: 35vh;
    }
}

/* 小屏手机断点 (< 576px) */
@media (max-width: 575px) {
    /* 头部优化 */
    .header {
        padding: 12px 16px;
    }
    
    .header-title {
        font-size: 16px;
    }
    
    .header-subtitle {
        display: none; /* 小屏隐藏副标题 */
    }
    
    /* 角色切换简化 */
    .role-switch span {
        display: none;
    }
    
    .role-switch .switch-slider {
        margin: 0;
    }
    
    /* 主布局改为单列 */
    .main-content {
        flex-direction: column;
    }
    
    /* 侧边栏优化 */
    .sidebar {
        width: 100%;
        max-height: 40vh;
        padding: 12px;
        gap: 12px;
        border-right: none;
        border-bottom: 1px solid var(--border-color);
        overflow-y: auto;
    }
    
    .section {
        padding: 12px;
    }
    
    .section-title {
        font-size: 14px;
        margin-bottom: 12px;
    }
    
    /* 检测类型按钮优化 */
    .inspection-types {
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
    }
    
    .type-btn {
        padding: 10px 8px;
        min-height: 48px; /* 触摸友好 */
    }
    
    .type-btn i {
        font-size: 20px;
    }
    
    .type-btn span {
        font-size: 11px;
    }
    
    /* 流程面板紧凑化 */
    .flow-panel {
        gap: 10px;
    }
    
    .flow-header {
        flex-wrap: wrap;
        gap: 8px;
    }
    
    .flow-point-name {
        padding: 10px;
        font-size: 13px;
    }
    
    .flow-buttons {
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
    }
    
    .flow-buttons .btn {
        min-height: 44px;
        padding: 10px;
    }
    
    /* 分数显示优化 */
    .score-display {
        padding: 12px;
    }
    
    .score-value {
        font-size: 36px;
    }
    
    .score-label {
        font-size: 12px;
    }
    
    /* 统计网格优化 */
    .issues-summary-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
    }
    
    .issue-stat-item {
        padding: 10px 4px;
        min-height: 60px;
    }
    
    .issue-stat-item .stat-value {
        font-size: 18px;
    }
    
    .issue-stat-item .stat-label {
        font-size: 10px;
    }
    
    /* 主面板优化 */
    .main-panel {
        flex-direction: column;
    }
    
    /* 3D画布最小高度 */
    .canvas-container {
        min-height: 40vh;
        height: 40vh;
    }
    
    /* 视口控制按钮放大 */
    .view-controls {
        bottom: 12px;
        right: 12px;
        gap: 8px;
    }
    
    .view-btn {
        width: 48px;
        height: 48px;
        font-size: 18px;
    }
    
    /* 热点图例位置调整 */
    .hotspot-legend {
        bottom: 12px;
        left: 12px;
        right: 12px;
        justify-content: center;
        flex-wrap: wrap;
        gap: 8px;
        padding: 10px;
    }
    
    .legend-item {
        font-size: 11px;
        padding: 4px 8px;
    }
    
    /* Info Panel优化 */
    .info-panel {
        width: 100%;
        height: auto;
        min-height: 200px;
        max-height: 35vh;
        border-left: none;
        border-top: 1px solid var(--border-color);
    }
    
    .info-section {
        padding: 12px;
    }
    
    /* 问题列表优化 */
    .issues-list {
        max-height: 150px;
    }
    
    .issue-card {
        padding: 10px;
    }
    
    /* 工具区优化 */
    .tools-section {
        padding: 12px;
    }
    
    .tool-buttons {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
    }
    
    .tools-section .btn {
        padding: 10px;
        font-size: 12px;
        justify-content: center;
        min-height: 44px;
    }
    
    /* 模态框优化 */
    .modal {
        padding: 10px;
    }
    
    .modal-content {
        border-radius: 12px;
        max-height: 95vh;
    }
    
    .modal-header {
        padding: 16px 20px;
    }
    
    .modal-header h3 {
        font-size: 16px;
    }
    
    .form-section {
        padding: 16px 20px;
    }
    
    .upload-buttons {
        grid-template-columns: 1fr;
    }
    
    .btn-upload-primary {
        padding: 12px 16px;
    }
    
    .severity-selector {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .image-preview-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .form-actions {
        flex-direction: column;
        padding: 16px 20px;
    }
    
    .form-actions .btn {
        width: 100%;
        min-height: 48px;
    }
}

/* 超小屏手机 (< 375px) */
@media (max-width: 374px) {
    .header-title {
        font-size: 14px;
    }
    
    .inspection-types {
        grid-template-columns: repeat(3, 1fr);
        gap: 6px;
    }
    
    .type-btn {
        padding: 8px 4px;
        min-height: 44px;
    }
    
    .type-btn i {
        font-size: 18px;
    }
    
    .type-btn span {
        font-size: 10px;
    }
    
    .flow-buttons {
        grid-template-columns: 1fr 1fr;
    }
    
    #btn-start-flow {
        grid-column: 1 / -1;
    }
    
    .issues-summary-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 6px;
    }
    
    .issue-stat-item {
        padding: 8px 4px;
    }
    
    .issue-stat-item .stat-value {
        font-size: 16px;
    }
    
    .issue-stat-item .stat-label {
        font-size: 10px;
    }
    
    .view-btn {
        width: 44px;
        height: 44px;
        font-size: 16px;
    }
}

/* 横屏模式优化 */
@media (max-width: 896px) and (orientation: landscape) {
    .main-content {
        flex-direction: row !important;
    }
    
    .sidebar {
        width: 260px !important;
        max-height: none !important;
        height: 100% !important;
        border-right: 1px solid var(--border-color);
        border-bottom: none;
    }
    
    .main-panel {
        flex-direction: row !important;
    }
    
    .canvas-container {
        min-height: auto;
        height: 100%;
    }
    
    .info-panel {
        width: 200px !important;
        height: 100% !important;
        max-height: none !important;
        border-left: 1px solid var(--border-color);
        border-top: none;
    }
    
    /* 简化热点图例 */
    .hotspot-legend {
        display: none;
    }
    
    /* 简化侧边栏 */
    .sidebar .section:first-child {
        display: none;
    }
}

/* iPhone 刘海屏适配 */
@supports (padding-top: env(safe-area-inset-top)) {
    .header {
        padding-top: max(16px, env(safe-area-inset-top));
        padding-left: max(16px, env(safe-area-inset-left));
        padding-right: max(16px, env(safe-area-inset-right));
    }
    
    .app-container {
        padding-bottom: env(safe-area-inset-bottom);
    }
    
    .modal {
        padding-bottom: max(20px, env(safe-area-inset-bottom));
    }
}

/* 触摸设备增强 */
@media (pointer: coarse) {
    /* 更大的点击区域 */
    .type-btn,
    .flow-buttons .btn,
    .issue-stat-item,
    .view-btn,
    .btn {
        min-height: 48px;
    }
    
    /* 增加触摸反馈 */
    .type-btn:active,
    .btn:active,
    .view-btn:active,
    .issue-card:active {
        transform: scale(0.96);
        opacity: 0.8;
        transition: transform 0.1s, opacity 0.1s;
    }
    
    /* 滚动优化 */
    .sidebar,
    .info-section,
    .modal-body,
    .issues-list {
        -webkit-overflow-scrolling: touch;
        overscroll-behavior: contain;
    }
    
    /* 禁用文本选择（提升触摸体验） */
    .canvas-container,
    .view-controls,
    .hotspot-legend,
    .type-btn {
        user-select: none;
        -webkit-user-select: none;
    }
    
    /* 禁用双击缩放 */
    .canvas-container {
        touch-action: pan-x pan-y;
    }
}

/* 减少动画偏好 */
@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}

/* 深色模式增强 */
@media (prefers-color-scheme: dark) {
    :root {
        color-scheme: dark;
    }
}

/* 打印样式 */
@media print {
    .header,
    .sidebar,
    .view-controls,
    .hotspot-legend,
    .tools-section {
        display: none !important;
    }
    
    .main-content {
        height: auto;
    }
    
    .canvas-container {
        height: 50vh;
        page-break-inside: avoid;
    }
    
    .info-panel {
        width: 100%;
        max-height: none;
    }
}
