/**
 * Touch Optimizations CSS
 * 移动端触摸交互优化样式
 */

/* ========================================
   1. 基础触摸优化
   ======================================== */

/* 全局触摸优化 */
html {
    /* 禁止字体大小自动调整 */
    -webkit-text-size-adjust: 100%;
    -ms-text-size-adjust: 100%;
    /* 优化滚动性能 */
    scroll-behavior: smooth;
}

/* 触摸设备基础样式 */
body {
    /* 消除点击高亮 */
    -webkit-tap-highlight-color: transparent;
    /* 禁止长按弹出菜单 */
    -webkit-touch-callout: none;
    /* 优化触摸响应 */
    touch-action: manipulation;
}

/* ========================================
   2. Canvas和3D区域触摸优化
   ======================================== */

/* 3D画布容器 */
.canvas-container,
#canvas-container,
#car-canvas {
    position: relative;
    /* 完全控制触摸行为 */
    touch-action: none;
    /* 禁止用户选择 */
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    /* 禁止长按弹出菜单 */
    -webkit-touch-callout: none;
    /* 优化渲染性能 */
    will-change: transform;
    /* 硬件加速 */
    transform: translateZ(0);
}

/* 画布元素本身 */
.canvas-container canvas,
#canvas-container canvas,
#car-canvas canvas {
    display: block;
    touch-action: none;
    user-select: none;
    -webkit-user-select: none;
    outline: none;
}

/* ========================================
   3. 按钮和可交互元素触摸优化
   ======================================== */

/* 所有按钮 */
button,
.btn,
.type-btn,
.view-btn,
.action-btn,
.icon-btn {
    /* 消除点击延迟 */
    touch-action: manipulation;
    /* 消除点击高亮 */
    -webkit-tap-highlight-color: transparent;
    /* 禁止元素被拖动 */
    -webkit-user-drag: none;
    /* 触摸时显示指针 */
    cursor: pointer;
    /* 禁用默认轮廓 */
    outline: none;
}

/* 按钮点击反馈 */
button:active,
.btn:active,
.type-btn:active,
.view-btn:active {
    transform: scale(0.96);
    transition: transform 0.1s ease;
}

/* 禁用状态的按钮 */
button:disabled,
.btn:disabled {
    touch-action: none;
    cursor: not-allowed;
    opacity: 0.6;
}

/* ========================================
   4. 热点相关触摸优化
   ======================================== */

/* 热点容器 */
.hotspot-marker,
.hotspot {
    touch-action: manipulation;
    cursor: pointer;
    /* 增大触摸区域（视觉不变） */
    position: relative;
}

/* 热点触摸区域扩展 */
.hotspot-marker::after,
.hotspot::after {
    content: '';
    position: absolute;
    top: -10px;
    left: -10px;
    right: -10px;
    bottom: -10px;
    /* 透明触摸扩展区域 */
    background: transparent;
}

/* 热点点击动画 */
@keyframes hotspot-touch-pulse {
    0% {
        transform: scale(1);
        opacity: 1;
    }
    50% {
        transform: scale(1.3);
        opacity: 0.8;
    }
    100% {
        transform: scale(1);
        opacity: 1;
    }
}

.hotspot-touch-active {
    animation: hotspot-touch-pulse 0.3s ease-out;
}

/* ========================================
   5. 卡片和列表项触摸优化
   ======================================== */

/* 问题卡片 */
.issue-card {
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
    cursor: pointer;
    /* 平滑的触摸反馈 */
    transition: transform 0.15s ease, box-shadow 0.15s ease;
}

.issue-card:active {
    transform: scale(0.98);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

/* 检测点列表项 */
.point-item {
    touch-action: manipulation;
    cursor: pointer;
}

.point-item:active {
    background-color: rgba(52, 152, 219, 0.1);
}

/* ========================================
   6. 模态框和弹窗触摸优化
   ======================================== */

.modal-overlay,
.lightbox-overlay {
    /* 确保覆盖层可以接收触摸事件 */
    touch-action: none;
}

.modal-content,
.lightbox-content {
    touch-action: auto;
    /* 允许内部滚动 */
    -webkit-overflow-scrolling: touch;
}

/* 模态框内的滚动区域 */
.modal-scrollable {
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    /* 防止iOS橡皮筋效果 */
    overscroll-behavior: contain;
}

/* ========================================
   7. 图片和缩略图触摸优化
   ======================================== */

/* 图片缩略图 */
.issue-thumbnail,
.image-thumbnail,
.preview-thumbnail {
    touch-action: manipulation;
    cursor: pointer;
    -webkit-tap-highlight-color: transparent;
}

/* 图片查看器 */
.lightbox-image-container img {
    touch-action: pinch-zoom;
    user-select: none;
    -webkit-user-select: none;
}

/* ========================================
   8. 表单元素触摸优化
   ======================================== */

/* 输入框 */
input,
textarea,
select {
    /* iOS上移除默认样式 */
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    /* 触摸优化 */
    touch-action: manipulation;
    font-size: 16px; /* 防止iOS缩放 */
}

/* 单选和复选框 */
input[type="radio"],
input[type="checkbox"] {
    width: 20px;
    height: 20px;
    cursor: pointer;
    touch-action: manipulation;
}

/* ========================================
   9. 滚动优化
   ======================================== */

/* 可滚动容器 */
.scrollable-container {
    overflow-y: auto;
    -webkit-overflow-scrolling: touch; /* iOS平滑滚动 */
    overscroll-behavior: contain; /* 防止滚动传播 */
}

/* 隐藏滚动条但保持功能 */
.hide-scrollbar {
    -ms-overflow-style: none;
    scrollbar-width: none;
}

.hide-scrollbar::-webkit-scrollbar {
    display: none;
}

/* ========================================
   10. 触摸反馈动画
   ======================================== */

/* 点击涟漪效果 */
@keyframes touch-ripple {
    0% {
        transform: scale(0);
        opacity: 0.5;
    }
    100% {
        transform: scale(2.5);
        opacity: 0;
    }
}

.touch-ripple-effect {
    position: absolute;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.4);
    pointer-events: none;
    animation: touch-ripple 0.6s ease-out forwards;
}

/* 按压效果 */
@keyframes press-effect {
    0% { transform: scale(1); }
    50% { transform: scale(0.95); }
    100% { transform: scale(1); }
}

.press-feedback {
    animation: press-effect 0.2s ease-out;
}

/* ========================================
   11. 设备特定优化
   ======================================== */

/* iPad/iOS 特定 */
@supports (-webkit-touch-callout: none) {
    /* iOS设备 */
    .ios-optimized {
        /* 防止iOS橡皮筋效果 */
        overscroll-behavior: none;
    }
    
    /* iOS上的canvas需要特殊处理 */
    canvas {
        /* 修复iOS上的触摸问题 */
        cursor: pointer;
    }
}

/* Android 特定 */
@supports not (-webkit-touch-callout: none) {
    /* Android设备 */
    .android-optimized {
        /* Android优化 */
        touch-action: manipulation;
    }
}

/* ========================================
   12. 响应式触摸优化
   ======================================== */

/* 小屏幕设备 */
@media (max-width: 768px) {
    /* 增大触摸目标 */
    button,
    .btn,
    .type-btn,
    .view-btn {
        min-height: 44px;
        min-width: 44px;
    }
    
    /* 增大热点触摸区域 */
    .hotspot-marker::after,
    .hotspot::after {
        top: -15px;
        left: -15px;
        right: -15px;
        bottom: -15px;
    }
    
    /* 列表项更大间距 */
    .issue-card {
        padding: 16px;
        margin-bottom: 12px;
    }
}

/* 平板设备 */
@media (min-width: 769px) and (max-width: 1366px) {
    /* 平板上的热点更大 */
    .hotspot-marker,
    .hotspot {
        transform: scale(1.5);
    }
    
    /* 按钮稍微大一些 */
    button,
    .btn {
        min-height: 40px;
        min-width: 40px;
    }
}

/* ========================================
   13. 防止文本选择
   ======================================== */

/* 禁止文本选择的区域 */
.no-text-select {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

/* 允许文本选择的区域 */
.allow-text-select {
    -webkit-user-select: text;
    -moz-user-select: text;
    -ms-user-select: text;
    user-select: text;
}

/* ========================================
   14. 性能优化
   ======================================== */

/* 启用硬件加速 */
.gpu-accelerated {
    transform: translateZ(0);
    backface-visibility: hidden;
    perspective: 1000;
}

/* will-change优化 */
.will-change-transform {
    will-change: transform;
}

.will-change-opacity {
    will-change: opacity;
}

/* ========================================
   15. 辅助功能
   ======================================== */

/* 高对比度模式下的触摸指示 */
@media (prefers-contrast: high) {
    .hotspot-marker:focus,
    .hotspot:focus,
    button:focus {
        outline: 3px solid currentColor;
        outline-offset: 2px;
    }
}

/* 减少动画偏好 */
@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}
