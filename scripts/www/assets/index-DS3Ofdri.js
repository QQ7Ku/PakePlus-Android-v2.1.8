var me=Object.defineProperty;var he=(r,s,t)=>s in r?me(r,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[s]=t;var J=(r,s,t)=>he(r,typeof s!="symbol"?s+"":s,t);import{u as V,r as l,j as e,C as be,O as pe,a as fe,b as ye,H as ae,R as Y,c as je}from"./three-zD1fqsvm.js";import{c as Ne,P as ve,a as we,X as H,T as le,C as Ce,U as ke,Z as _e,b as Re,D as ne,d as Se,e as Z,f as q,g as F,A as K,h as G,I as A,S as Ee,G as Ie,R as $e,i as Oe,j as Pe,k as Te,l as De,F as Ae,m as Me,L as Le,E as ze,M as Ue,n as He,o as Fe}from"./vendor-BpJyseoD.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();V.setDecoderPath("./draco/");console.log("Draco decoder path set to: ./draco/");const Ke=r=>(s,t,i)=>{const o=i.subscribe;return i.subscribe=(d,x,m)=>{let y=d;if(x){const w=(m==null?void 0:m.equalityFn)||Object.is;let f=d(i.getState());y=_=>{const C=d(_);if(!w(f,C)){const j=f;x(f=C,j)}},m!=null&&m.fireImmediately&&x(f,f)}return o(y)},r(s,t,i)},Ge=Ke,D={structure:[{id:"left_front_longitudinal",name:"å·¦å‰çºµæ¢",category:"structure"},{id:"right_front_longitudinal",name:"å³å‰çºµæ¢",category:"structure"},{id:"left_front_shock",name:"å·¦å‰æ‚¬æŒ‚å‡éœ‡å™¨",category:"structure"},{id:"right_front_shock",name:"å³å‰æ‚¬æŒ‚å‡éœ‡å™¨",category:"structure"},{id:"left_rear_shock",name:"å·¦åæ‚¬æŒ‚å‡éœ‡å™¨",category:"structure"},{id:"right_rear_shock",name:"å³åæ‚¬æŒ‚å‡éœ‡å™¨",category:"structure"}],paint:[{id:"left_a_pillar_paint",name:"å·¦AæŸ±æ¼†é¢",category:"paint",parent:"left_a_pillar"},{id:"left_a_pillar_weld",name:"å·¦AæŸ±ç„Šç‚¹èƒ¶æ¡",category:"paint",parent:"left_a_pillar"},{id:"right_a_pillar_paint",name:"å³AæŸ±æ¼†é¢",category:"paint",parent:"right_a_pillar"},{id:"right_a_pillar_weld",name:"å³AæŸ±ç„Šç‚¹èƒ¶æ¡",category:"paint",parent:"right_a_pillar"},{id:"left_b_pillar_paint",name:"å·¦BæŸ±æ¼†é¢",category:"paint",parent:"left_b_pillar"},{id:"left_b_pillar_weld",name:"å·¦BæŸ±ç„Šç‚¹èƒ¶æ¡",category:"paint",parent:"left_b_pillar"},{id:"right_b_pillar_paint",name:"å³BæŸ±æ¼†é¢",category:"paint",parent:"right_b_pillar"},{id:"right_b_pillar_weld",name:"å³BæŸ±ç„Šç‚¹èƒ¶æ¡",category:"paint",parent:"right_b_pillar"},{id:"left_c_pillar_paint",name:"å·¦CæŸ±æ¼†é¢",category:"paint",parent:"left_c_pillar"},{id:"left_c_pillar_weld",name:"å·¦CæŸ±ç„Šç‚¹èƒ¶æ¡",category:"paint",parent:"left_c_pillar"},{id:"right_c_pillar_paint",name:"å³CæŸ±æ¼†é¢",category:"paint",parent:"right_c_pillar"},{id:"right_c_pillar_weld",name:"å³CæŸ±ç„Šç‚¹èƒ¶æ¡",category:"paint",parent:"right_c_pillar"}]},u={UNCHECKED:"unchecked",NORMAL:"normal",WARNING:"warning",ERROR:"error"},Q=new Set(Object.values(u)),ee=r=>{if(!r||typeof r!="object")return{};const s=["__proto__","constructor","prototype"];return Object.fromEntries(Object.entries(r).filter(([t])=>!s.includes(t)))},M=r=>!r||typeof r!="string"?!1:[...D.structure,...D.paint].some(t=>t.id===r),S=Ne(Ge((r,s)=>({currentType:"structure",selectedPoint:null,results:{},setCurrentType:t=>{if(!["structure","paint"].includes(t)){console.warn(`Invalid inspection type: ${t}`);return}r({currentType:t,selectedPoint:null})},selectPoint:t=>{if(t&&!M(t)){console.warn(`Invalid point ID: ${t}`);return}r({selectedPoint:t})},setResult:(t,i,o={})=>{if(!t){console.error("setResult: pointId is required");return}if(!M(t)){console.error(`setResult: Invalid point ID: ${t}`);return}if(!Q.has(i)){console.error(`setResult: Invalid status: ${i}`);return}const a=ee(o);let d={...a};if(a.paintThickness!==void 0){const x=parseInt(a.paintThickness,10);isNaN(x)||x<0||x>3e3?(console.warn(`Invalid paint thickness: ${a.paintThickness}`),d.paintThickness=void 0):d.paintThickness=x}a.note&&(d.note=String(a.note).trim().slice(0,500)),a.images&&Array.isArray(a.images)&&(d.images=a.images.slice(0,5)),r(x=>({results:{...x.results,[t]:{status:i,timestamp:new Date().toISOString(),...d}}}))},addImage:(t,i)=>!t||!M(t)?(console.error(`addImage: Invalid point ID: ${t}`),!1):!i||typeof i!="string"?(console.error("addImage: Invalid image data"),!1):(r(o=>{const a=o.results[t]||{},d=a.images||[];return d.length>=5?(console.warn("Maximum 5 images allowed"),o):{results:{...o.results,[t]:{...a,images:[...d,i]}}}}),!0),removeImage:(t,i)=>!t||!M(t)?(console.error(`removeImage: Invalid point ID: ${t}`),!1):(r(o=>{const a=o.results[t];if(!a||!a.images)return o;const d=a.images.filter((x,m)=>m!==i);return{results:{...o.results,[t]:{...a,images:d}}}}),!0),getPointStatus:t=>{if(!t)return u.UNCHECKED;const i=s().results[t];return(i==null?void 0:i.status)||u.UNCHECKED},getStats:()=>{const{currentType:t,results:i}=s(),o=D[t];if(!o)return{total:0,checked:0,normal:0,warning:0,error:0,unchecked:0};const a={total:o.length,checked:0,normal:0,warning:0,error:0,unchecked:0};return o.forEach(d=>{var m;const x=((m=i[d.id])==null?void 0:m.status)||u.UNCHECKED;x!==u.UNCHECKED&&a.checked++,a[x]!==void 0&&a[x]++}),a},getPointResult:t=>t&&s().results[t]||null,resetResults:()=>r({results:{},selectedPoint:null}),exportData:()=>({timestamp:new Date().toISOString(),results:s().results,stats:s().getStats()}),importData:t=>{if(!t||typeof t!="object")return console.error("importData: Invalid data format"),!1;if(t.results&&typeof t.results=="object"){const i={};return Object.entries(t.results).forEach(([o,a])=>{M(o)&&Q.has(a.status)&&(i[o]={status:a.status,timestamp:a.timestamp||new Date().toISOString(),...ee(a)})}),r({results:i}),!0}return!1}}))),U={UNCHECKED:"unchecked",WARNING:"warning",ERROR:"error"},We=[{id:"left_front_longitudinal",name:"å·¦å‰çºµæ¢",pos:[-1.5,.5,2]},{id:"right_front_longitudinal",name:"å³å‰çºµæ¢",pos:[1.5,.5,2]},{id:"left_front_shock",name:"å·¦å‰æ‚¬æŒ‚",pos:[-1.2,.3,1.5]},{id:"right_front_shock",name:"å³å‰æ‚¬æŒ‚",pos:[1.2,.3,1.5]},{id:"left_rear_shock",name:"å·¦åæ‚¬æŒ‚",pos:[-1.2,.3,-1.5]},{id:"right_rear_shock",name:"å³åæ‚¬æŒ‚",pos:[1.2,.3,-1.5]}],Be=[{id:"left_a_pillar_paint",name:"å·¦AæŸ±æ¼†é¢",pos:[-.9,1.2,.8]},{id:"left_a_pillar_weld",name:"å·¦AæŸ±ç„Šç‚¹",pos:[-.85,1,.8]},{id:"right_a_pillar_paint",name:"å³AæŸ±æ¼†é¢",pos:[.9,1.2,.8]},{id:"right_a_pillar_weld",name:"å³AæŸ±ç„Šç‚¹",pos:[.85,1,.8]},{id:"left_b_pillar_paint",name:"å·¦BæŸ±æ¼†é¢",pos:[-.9,1.2,-.3]},{id:"left_b_pillar_weld",name:"å·¦BæŸ±ç„Šç‚¹",pos:[-.85,1,-.3]},{id:"right_b_pillar_paint",name:"å³BæŸ±æ¼†é¢",pos:[.9,1.2,-.3]},{id:"right_b_pillar_weld",name:"å³BæŸ±ç„Šç‚¹",pos:[.85,1,-.3]},{id:"left_c_pillar_paint",name:"å·¦CæŸ±æ¼†é¢",pos:[-.85,1.3,-1.2]},{id:"left_c_pillar_weld",name:"å·¦CæŸ±ç„Šç‚¹",pos:[-.8,1.1,-1.2]},{id:"right_c_pillar_paint",name:"å³CæŸ±æ¼†é¢",pos:[.85,1.3,-1.2]},{id:"right_c_pillar_weld",name:"å³CæŸ±ç„Šç‚¹",pos:[.8,1.1,-1.2]}];function qe(){const{progress:r}=ye();return e.jsx(ae,{center:!0,children:e.jsxs("div",{className:"bg-gray-900/90 backdrop-blur-sm text-white p-5 rounded-xl text-center border border-gray-700 shadow-2xl max-w-[80vw]",children:[e.jsx("div",{className:"text-base font-bold mb-3",children:"åŠ è½½æ¨¡å‹ä¸­..."}),e.jsx("div",{className:"w-48 h-2 bg-gray-800 rounded-full overflow-hidden mx-auto",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-cyan-400 transition-all duration-300",style:{width:`${r}%`}})}),e.jsxs("div",{className:"mt-2 text-xs text-gray-400",children:[Math.round(r),"%"]})]})})}function Ve({name:r,status:s,onClick:t}){const i=s===U.ERROR,o=s===U.WARNING;return!i&&!o?null:e.jsx(ae,{distanceFactor:10,children:e.jsx("div",{onClick:a=>{a.stopPropagation(),t==null||t()},className:`
          px-2 py-1 rounded text-xs font-bold whitespace-nowrap cursor-pointer
          shadow-lg border border-white/20 select-none
          active:scale-95 transition-transform
          ${i?"bg-red-500 text-white":"bg-yellow-500 text-black"}
        `,style:{touchAction:"manipulation"},children:r})})}function Ye({autoRotate:r,onPointClick:s}){const t=l.useRef(),i=S(x=>x.results),{scene:o}=V("/models/2019_volkswagen_jetta_draco.glb");fe((x,m)=>{t.current&&r&&(t.current.rotation.y+=m*.5)});const a=x=>{var m;return((m=i[x])==null?void 0:m.status)||U.UNCHECKED},d=[...We,...Be];return e.jsxs("group",{ref:t,children:[e.jsx("primitive",{object:o,scale:1,position:[0,0,0]}),d.map(x=>{const m=a(x.id);return m===U.WARNING||m===U.ERROR?e.jsx("group",{position:x.pos,children:e.jsx(Ve,{name:x.name,status:m,onClick:()=>s==null?void 0:s(x.id)})},x.id):null})]})}function Ze({autoRotate:r,onPointClick:s}){const t=l.useRef();return l.useEffect(()=>{const i="ontouchstart"in window||navigator.maxTouchPoints>0;t.current&&i&&(t.current.touchAction="none")},[]),e.jsxs(e.Fragment,{children:[e.jsx("ambientLight",{intensity:.6}),e.jsx("directionalLight",{position:[10,10,5],intensity:1}),e.jsx("directionalLight",{position:[-10,-10,-5],intensity:.5}),e.jsx(pe,{ref:t,enablePan:!0,enableZoom:!0,enableRotate:!0,minDistance:3,maxDistance:15,enableDamping:!0,dampingFactor:.05}),e.jsx("gridHelper",{args:[20,20,"#333","#222"]}),e.jsx(l.Suspense,{fallback:e.jsx(qe,{}),children:e.jsx(Ye,{autoRotate:r,onPointClick:s})})]})}function W({color:r,label:s}){return e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{backgroundColor:r}}),e.jsx("span",{className:"text-[10px] text-gray-400",children:s})]})}function Xe({onPointClick:r}){const[s,t]=l.useState(!1),i=S(d=>d.currentType),[o,a]=l.useState(!1);return l.useEffect(()=>{a("ontouchstart"in window||navigator.maxTouchPoints>0)},[]),e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx(be,{camera:{position:[5,5,5],fov:50},className:"w-full h-full block outline-none touch-none",gl:{antialias:!0,alpha:!1},children:e.jsx(Ze,{autoRotate:s,onPointClick:r})}),e.jsx("button",{onClick:()=>t(!s),className:`
          absolute bottom-4 right-4 z-50 rounded-full 
          flex items-center justify-center
          transition-all duration-200 active:scale-95
          border shadow-lg
          ${o?"w-12 h-12":"w-10 h-10"}
          ${s?"bg-blue-600 border-blue-500":"bg-gray-800/90 border-gray-600"}
        `,style:{touchAction:"manipulation"},title:s?"åœæ­¢æ—‹è½¬":"å¼€å§‹æ—‹è½¬",children:s?e.jsx(ve,{className:`${o?"w-5 h-5":"w-4 h-4"} text-white`}):e.jsx(we,{className:`${o?"w-5 h-5":"w-4 h-4"} text-white ml-0.5`})}),e.jsx("div",{className:"absolute top-3 left-3 lg:top-4 lg:left-4 z-50 bg-gray-900/90 backdrop-blur-sm px-2.5 py-2 lg:px-3 lg:py-2 rounded-lg border border-gray-700 shadow-lg",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(W,{color:"#22c55e",label:"æ­£å¸¸"}),e.jsx(W,{color:"#eab308",label:"å¼‚å¸¸"}),e.jsx(W,{color:"#ef4444",label:"ä¸¥é‡"}),e.jsx(W,{color:"#9ca3af",label:"æœªæ£€"})]})}),e.jsx("div",{className:"absolute top-3 right-3 lg:top-4 lg:right-4 z-50 bg-gray-900/90 backdrop-blur-sm px-2.5 py-1.5 lg:px-3 rounded-lg border border-gray-700 shadow-lg",children:e.jsx("span",{className:"text-[10px] lg:text-xs text-gray-400",children:i==="structure"?"è½¦èº«ç»“æ„æ£€æµ‹":"è½¦èº«æ¼†é¢æ£€æµ‹"})}),o&&e.jsx("div",{className:"absolute bottom-16 left-4 right-4 lg:hidden z-40 pointer-events-none",children:e.jsx("div",{className:"bg-gray-900/80 backdrop-blur-sm px-3 py-2 rounded-lg border border-gray-700 text-center",children:e.jsx("p",{className:"text-[10px] text-gray-400",children:"ğŸ‘† å•æŒ‡æ—‹è½¬ Â· ğŸ¤ åŒæŒ‡ç¼©æ”¾"})})})]})}V.preload("/models/2019_volkswagen_jetta_draco.glb");const Je=({images:r=[],onImagesChange:s,maxImages:t=5})=>{const[i,o]=l.useState(!1),[a,d]=l.useState(null),[x,m]=l.useState(null),y=l.useRef(null),w=l.useRef(null),f=l.useRef(null),_=(b,v=1280,I=.7)=>new Promise(T=>{const g=new Image;g.src=b,g.onload=()=>{const k=document.createElement("canvas");let n=g.width,h=g.height;n>v&&(h=Math.round(h*v/n),n=v),k.width=n,k.height=h,k.getContext("2d").drawImage(g,0,0,n,h),T(k.toDataURL("image/jpeg",I))}}),C=l.useCallback(async()=>{try{const b=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}},audio:!1});d(b),o(!0),y.current&&(y.current.srcObject=b)}catch(b){console.error("æ— æ³•è®¿é—®æ‘„åƒå¤´:",b),alert("æ— æ³•è®¿é—®æ‘„åƒå¤´ï¼Œè¯·ç¡®ä¿å·²æˆäºˆæƒé™æˆ–ä½¿ç”¨å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½")}},[]),j=l.useCallback(()=>{a&&(a.getTracks().forEach(b=>b.stop()),d(null)),o(!1)},[a]),P=l.useCallback(()=>{if(!y.current||!w.current)return;const b=y.current,v=w.current;v.width=b.videoWidth,v.height=b.videoHeight,v.getContext("2d").drawImage(b,0,0);const T=v.toDataURL("image/jpeg",.9);m(T)},[]),E=l.useCallback(async()=>{if(!x)return;if(r.length>=t){alert(`æœ€å¤šåªèƒ½ä¸Šä¼  ${t} å¼ å›¾ç‰‡`);return}const b=await _(x);s([...r,b]),m(null),j()},[x,r,t,s,j]),$=l.useCallback(()=>{m(null)},[]),N=l.useCallback(async b=>{const v=b.target.files;if(!v||v.length===0)return;const I=t-r.length;if(I<=0){alert(`æœ€å¤šåªèƒ½ä¸Šä¼  ${t} å¼ å›¾ç‰‡`);return}const T=Array.from(v).slice(0,I);for(const g of T){if(!g.type.startsWith("image/"))continue;const k=new FileReader;k.onload=async n=>{const h=n.target.result,c=await _(h);s(p=>[...p,c])},k.readAsDataURL(g)}f.current&&(f.current.value="")},[r.length,t,s]),R=l.useCallback(b=>{s(r.filter((v,I)=>I!==b))},[r,s]);return i?e.jsx("div",{className:"fixed inset-0 z-50 bg-black flex flex-col",children:e.jsxs("div",{className:"flex-1 relative bg-black",children:[x?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:x,alt:"Preview",className:"w-full h-full object-contain"}),e.jsxs("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center gap-4",children:[e.jsx("button",{onClick:$,className:"px-6 py-3 bg-gray-600 text-white rounded-lg font-medium",children:"é‡æ‹"}),e.jsx("button",{onClick:E,className:"px-6 py-3 bg-green-600 text-white rounded-lg font-medium",children:"ç¡®è®¤"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("video",{ref:y,autoPlay:!0,playsInline:!0,className:"w-full h-full object-contain"}),e.jsx("canvas",{ref:w,className:"hidden"}),e.jsx("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center",children:e.jsx("button",{onClick:P,className:"w-16 h-16 rounded-full bg-white border-4 border-gray-300 flex items-center justify-center active:scale-95 transition-transform",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-white border-2 border-gray-800"})})})]}),e.jsx("button",{onClick:j,className:"absolute top-4 right-4 p-2 bg-black/50 text-white rounded-full",children:e.jsx(H,{size:24})})]})}):e.jsxs("div",{className:"space-y-3",children:[r.length>0&&e.jsx("div",{className:"grid grid-cols-3 gap-2",children:r.map((b,v)=>e.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden border border-gray-700 group",children:[e.jsx("img",{src:b,alt:`æ£€æµ‹å›¾ç‰‡ ${v+1}`,className:"w-full h-full object-cover"}),e.jsx("button",{onClick:()=>R(v),className:"absolute top-1 right-1 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(le,{size:14})})]},v))}),r.length<t&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:C,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-blue-600 hover:bg-blue-500 text-white rounded-lg transition-colors",children:[e.jsx(Ce,{size:18}),e.jsx("span",{className:"text-sm font-medium",children:"æ‹ç…§"})]}),e.jsxs("label",{className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors cursor-pointer",children:[e.jsx(ke,{size:18}),e.jsx("span",{className:"text-sm font-medium",children:"ä¸Šä¼ "}),e.jsx("input",{ref:f,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:N})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 text-center",children:["å·²ä¸Šä¼  ",r.length,"/",t," å¼ å›¾ç‰‡",r.length>=t&&" (å·²è¾¾ä¸Šé™)"]})]})},oe=({images:r=[],initialIndex:s=0,isOpen:t,onClose:i,onDelete:o,title:a="å›¾ç‰‡æŸ¥çœ‹"})=>{const[d,x]=l.useState(s),[m,y]=l.useState(1),[w,f]=l.useState(!1),[_,C]=l.useState({x:0,y:0}),[j,P]=l.useState({x:0,y:0});l.useEffect(()=>{t&&(x(s),y(1),C({x:0,y:0}))},[t,s]),l.useEffect(()=>{if(!t)return;const c=p=>{switch(p.key){case"Escape":i();break;case"ArrowLeft":E();break;case"ArrowRight":$();break;case"+":case"=":N();break;case"-":R();break;case"0":b();break}};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[t,d,r.length]),l.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[t]);const E=l.useCallback(()=>{x(c=>c>0?c-1:r.length-1),b()},[r.length]),$=l.useCallback(()=>{x(c=>c<r.length-1?c+1:0),b()},[r.length]),N=l.useCallback(()=>{y(c=>Math.min(c+.25,3))},[]),R=l.useCallback(()=>{y(c=>Math.max(c-.25,.5))},[]),b=l.useCallback(()=>{y(1),C({x:0,y:0})},[]),v=l.useCallback(()=>{const c=r[d];if(!c)return;const p=document.createElement("a");p.href=c,p.download=`æ£€æµ‹ç…§ç‰‡_${d+1}_${new Date().toISOString().slice(0,10)}.jpg`,document.body.appendChild(p),p.click(),document.body.removeChild(p)},[r,d]),I=l.useCallback(()=>{o&&(o(d),r.length<=1?i():d>=r.length-1&&x(r.length-2))},[o,d,r.length,i]),T=l.useCallback(c=>{m>1&&(f(!0),P({x:c.clientX-_.x,y:c.clientY-_.y}))},[m,_]),g=l.useCallback(c=>{w&&m>1&&C({x:c.clientX-j.x,y:c.clientY-j.y})},[w,j,m]),k=l.useCallback(()=>{f(!1)},[]),n=l.useCallback(c=>{c.preventDefault(),c.deltaY<0?N():R()},[N,R]);if(!t||r.length===0)return null;const h=r[d];return e.jsxs("div",{className:"fixed inset-0 z-[100] bg-black/95 flex flex-col",onClick:i,children:[e.jsxs("div",{className:"flex-none flex items-center justify-between px-4 py-3 bg-gradient-to-b from-black/50 to-transparent",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-white font-medium",children:a}),e.jsxs("span",{className:"text-gray-400 text-sm",children:[d+1," / ",r.length]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-gray-800/80 rounded-lg p-1",children:[e.jsx("button",{onClick:c=>{c.stopPropagation(),R()},className:"p-2 hover:bg-gray-700 rounded-md text-gray-300 transition-colors",title:"ç¼©å° (-)",children:e.jsx(_e,{size:18})}),e.jsxs("span",{className:"text-xs text-gray-400 w-12 text-center",children:[Math.round(m*100),"%"]}),e.jsx("button",{onClick:c=>{c.stopPropagation(),N()},className:"p-2 hover:bg-gray-700 rounded-md text-gray-300 transition-colors",title:"æ”¾å¤§ (+)",children:e.jsx(Re,{size:18})})]}),e.jsx("button",{onClick:c=>{c.stopPropagation(),v()},className:"p-2 hover:bg-gray-700 rounded-lg text-gray-300 transition-colors",title:"ä¸‹è½½å›¾ç‰‡",children:e.jsx(ne,{size:20})}),o&&e.jsx("button",{onClick:c=>{c.stopPropagation(),I()},className:"p-2 hover:bg-red-600/20 rounded-lg text-red-400 transition-colors",title:"åˆ é™¤å›¾ç‰‡",children:e.jsx(le,{size:20})}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-700 rounded-lg text-gray-300 transition-colors ml-2",title:"å…³é—­ (Esc)",children:e.jsx(H,{size:24})})]})]}),e.jsxs("div",{className:"flex-1 relative flex items-center justify-center overflow-hidden",onWheel:n,children:[r.length>1&&e.jsx("button",{onClick:c=>{c.stopPropagation(),E()},className:"absolute left-4 z-10 p-3 bg-black/50 hover:bg-black/70 rounded-full text-white transition-all",title:"ä¸Šä¸€å¼  (â†)",children:e.jsx(Se,{size:28})}),e.jsx("div",{className:"relative max-w-full max-h-full",onClick:c=>c.stopPropagation(),onMouseDown:T,onMouseMove:g,onMouseUp:k,onMouseLeave:k,style:{cursor:m>1?w?"grabbing":"grab":"default"},children:e.jsx("img",{src:h,alt:`å›¾ç‰‡ ${d+1}`,className:"max-w-full max-h-[calc(100vh-180px)] object-contain transition-transform duration-200",style:{transform:`translate(${_.x}px, ${_.y}px) scale(${m})`,transformOrigin:"center center"},draggable:!1})}),r.length>1&&e.jsx("button",{onClick:c=>{c.stopPropagation(),$()},className:"absolute right-4 z-10 p-3 bg-black/50 hover:bg-black/70 rounded-full text-white transition-all",title:"ä¸‹ä¸€å¼  (â†’)",children:e.jsx(Z,{size:28})})]}),r.length>1&&e.jsx("div",{className:"flex-none px-4 py-3 bg-gradient-to-t from-black/50 to-transparent",children:e.jsx("div",{className:"flex items-center justify-center gap-2 overflow-x-auto max-w-full",children:r.map((c,p)=>e.jsx("button",{onClick:O=>{O.stopPropagation(),x(p),b()},className:`
                  relative flex-shrink-0 w-16 h-16 rounded-lg overflow-hidden border-2 transition-all
                  ${p===d?"border-blue-500 ring-2 ring-blue-500/30":"border-transparent hover:border-gray-500"}
                `,children:e.jsx("img",{src:c,alt:`ç¼©ç•¥å›¾ ${p+1}`,className:"w-full h-full object-cover"})},p))})}),e.jsx("div",{className:"absolute bottom-20 left-1/2 -translate-x-1/2 text-gray-500 text-xs pointer-events-none",children:"â† â†’ åˆ‡æ¢ | +/- ç¼©æ”¾ | Esc å…³é—­"})]})},X={[u.NORMAL]:{bg:"bg-green-500",hover:"hover:bg-green-600",text:"text-green-400",bgOpacity:"bg-green-500/10",border:"border-green-500/30",ring:"ring-green-500/50"},[u.WARNING]:{bg:"bg-yellow-500",hover:"hover:bg-yellow-600",text:"text-yellow-400",bgOpacity:"bg-yellow-500/10",border:"border-yellow-500/30",ring:"ring-yellow-500/50"},[u.ERROR]:{bg:"bg-red-500",hover:"hover:bg-red-600",text:"text-red-400",bgOpacity:"bg-red-500/10",border:"border-red-500/30",ring:"ring-red-500/50"},[u.UNCHECKED]:{bg:"bg-gray-500",hover:"hover:bg-gray-600",text:"text-gray-400",bgOpacity:"bg-gray-500/10",border:"border-gray-500/30",ring:"ring-gray-500/50"}},ie={[u.NORMAL]:"æ­£å¸¸",[u.WARNING]:"å¼‚å¸¸",[u.ERROR]:"ä¸¥é‡",[u.UNCHECKED]:"æœªæ£€"},ce={[u.NORMAL]:G,[u.WARNING]:K,[u.ERROR]:F,[u.UNCHECKED]:q},z=l.memo(({status:r,active:s,onClick:t,label:i,icon:o})=>{const a=X[r];return e.jsxs("button",{onClick:t,className:`
        flex flex-col items-center justify-center p-2.5 rounded-lg
        transition-all duration-200 ease-out border
        ${s?`${a.bg} border-transparent text-white shadow-lg`:`${a.bgOpacity} ${a.border} ${a.text} hover:bg-opacity-20`}
        ${s?`ring-2 ${a.ring} ring-offset-2 ring-offset-gray-900`:""}
      `,children:[e.jsx(o,{className:"w-4 h-4 mb-1"}),e.jsx("span",{className:"text-xs font-medium",children:i})]})});z.displayName="StatusButton";const de=l.memo(({point:r,status:s,isSelected:t,onClick:i,hasPaintData:o,result:a})=>{const d=ce[s],x=X[s],m=(a==null?void 0:a.images)&&a.images.length>0;return e.jsxs("div",{onClick:i,className:`
        group flex items-center justify-between p-2.5 rounded-lg cursor-pointer
        transition-all duration-200 border
        ${t?"bg-blue-500/10 border-blue-500/50":"bg-gray-900/30 border-gray-800 hover:border-gray-700 hover:bg-gray-800/30"}
      `,children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx(d,{className:`w-4 h-4 ${x.text}`}),e.jsxs("div",{children:[e.jsx("span",{className:`text-sm font-medium ${t?"text-blue-400":"text-gray-300"}`,children:r.name}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5",children:[(a==null?void 0:a.paintThickness)&&e.jsxs("span",{className:"text-xs text-gray-500",children:[a.paintThickness,"Î¼m"]}),m&&e.jsxs("span",{className:"flex items-center gap-0.5 text-[10px] text-blue-400",children:[e.jsx(A,{className:"w-3 h-3"}),a.images.length]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`
          text-[10px] px-1.5 py-0.5 rounded border
          ${x.bgOpacity} ${x.text} ${x.border}
        `,children:ie[s]}),e.jsx(Z,{className:"w-4 h-4 text-gray-600 group-hover:text-gray-400 transition-colors"})]})]})});de.displayName="PointItem";const B=l.memo(({label:r,value:s,colorClass:t})=>e.jsxs("div",{className:"bg-gray-900/30 rounded-lg p-2.5 border border-gray-800",children:[e.jsx("p",{className:"text-[10px] text-gray-500 mb-0.5 uppercase tracking-wider",children:r}),e.jsx("p",{className:`text-lg font-bold ${t}`,children:s})]}));B.displayName="StatCard";const xe=l.memo(({images:r,onImageClick:s})=>!r||r.length===0?null:e.jsx("div",{className:"grid grid-cols-3 gap-2",children:r.map((t,i)=>e.jsxs("button",{onClick:()=>s==null?void 0:s(i),className:"relative aspect-square rounded-lg overflow-hidden border border-gray-700 hover:border-gray-500 transition-colors group",children:[e.jsx("img",{src:t,alt:`æ£€æµ‹å›¾ç‰‡ ${i+1}`,className:"w-full h-full object-cover group-hover:scale-105 transition-transform"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors flex items-center justify-center",children:e.jsx("span",{className:"text-white opacity-0 group-hover:opacity-100 text-xs font-medium",children:"æŸ¥çœ‹"})})]},i))}));xe.displayName="ImagePreview";const ge=l.memo(({point:r,result:s,onEdit:t,onImageDelete:i})=>{const o=ce[(s==null?void 0:s.status)||u.UNCHECKED],a=X[(s==null?void 0:s.status)||u.UNCHECKED],[d,x]=l.useState(!1),[m,y]=l.useState(0),w=r.category==="paint",f=(s==null?void 0:s.images)&&s.images.length>0,_=l.useCallback(j=>{y(j),x(!0)},[]),C=l.useCallback(j=>{i==null||i(r.id,j)},[i,r.id]);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between pb-3 border-b border-gray-800",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-200",children:r.name}),e.jsx("p",{className:"text-xs text-gray-500",children:w?"è½¦èº«æ¼†é¢æ£€æµ‹":"è½¦èº«ç»“æ„æ£€æµ‹"})]}),e.jsx("button",{onClick:t,className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-500 text-white rounded-lg transition-colors",children:"ç¼–è¾‘"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-2 uppercase tracking-wider",children:"æ£€æµ‹çŠ¶æ€"}),e.jsxs("div",{className:`
          flex items-center gap-3 p-3 rounded-lg border
          ${a.bgOpacity} ${a.border}
        `,children:[e.jsx(o,{className:`w-6 h-6 ${a.text}`}),e.jsxs("div",{children:[e.jsx("p",{className:`font-medium ${a.text}`,children:ie[(s==null?void 0:s.status)||u.UNCHECKED]}),(s==null?void 0:s.timestamp)&&e.jsxs("p",{className:"text-xs text-gray-500",children:["æ£€æµ‹æ—¶é—´: ",new Date(s.timestamp).toLocaleString("zh-CN")]})]})]})]}),w&&(s==null?void 0:s.paintThickness)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1.5 uppercase tracking-wider",children:"æ¼†é¢åšåº¦"}),e.jsx("div",{className:"p-3 bg-gray-900 border border-gray-800 rounded-lg",children:e.jsxs("p",{className:"text-lg font-medium text-gray-200",children:[s.paintThickness," ",e.jsx("span",{className:"text-sm text-gray-500",children:"Î¼m"})]})})]}),f&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-2 uppercase tracking-wider",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(A,{className:"w-3 h-3"}),"é—®é¢˜ç…§ç‰‡ (",s.images.length," å¼ )"]})}),e.jsx(xe,{images:s.images,onImageClick:_})]}),(s==null?void 0:s.note)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1.5 uppercase tracking-wider",children:"å¤‡æ³¨è¯´æ˜"}),e.jsx("div",{className:"p-3 bg-gray-900 border border-gray-800 rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-300 whitespace-pre-wrap",children:s.note})})]}),e.jsx(oe,{images:(s==null?void 0:s.images)||[],initialIndex:m,isOpen:d,onClose:()=>x(!1),onDelete:C,title:r.name})]})});ge.displayName="ResultViewer";const ue=l.memo(({point:r,result:s,onSave:t,onCancel:i})=>{const[o,a]=l.useState((s==null?void 0:s.status)||u.NORMAL),[d,x]=l.useState((s==null?void 0:s.paintThickness)||""),[m,y]=l.useState((s==null?void 0:s.note)||""),[w,f]=l.useState((s==null?void 0:s.images)||[]),[_,C]=l.useState(null),j=r.category==="paint",P=o===u.WARNING||o===u.ERROR,E=l.useCallback(()=>{if(j&&d!==""){const R=parseInt(d,10);if(isNaN(R)||R<0||R>3e3){C("æ¼†é¢åšåº¦å¿…é¡»åœ¨ 0-3000Î¼m ä¹‹é—´");return}}const N={status:o,note:m.trim()};j&&d!==""&&(N.paintThickness=parseInt(d,10)),P&&w.length>0&&(N.images=w),t(r.id,o,N)},[r.id,r.category,o,d,m,w,P,t,j]),$=l.useCallback(N=>{a(N),C(null)},[]);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between pb-3 border-b border-gray-800",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-200",children:r.name}),e.jsx("p",{className:"text-xs text-gray-500",children:j?"è½¦èº«æ¼†é¢æ£€æµ‹":"è½¦èº«ç»“æ„æ£€æµ‹"})]}),e.jsx("button",{onClick:i,className:"p-1.5 hover:bg-gray-800 rounded-lg transition-colors border border-gray-800",children:e.jsx(H,{className:"w-4 h-4 text-gray-400"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-2 uppercase tracking-wider",children:"æ£€æµ‹çŠ¶æ€"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsx(z,{status:u.NORMAL,active:o===u.NORMAL,onClick:()=>$(u.NORMAL),label:"æ­£å¸¸",icon:G}),e.jsx(z,{status:u.WARNING,active:o===u.WARNING,onClick:()=>$(u.WARNING),label:"å¼‚å¸¸",icon:K}),e.jsx(z,{status:u.ERROR,active:o===u.ERROR,onClick:()=>$(u.ERROR),label:"ä¸¥é‡",icon:F}),e.jsx(z,{status:u.UNCHECKED,active:o===u.UNCHECKED,onClick:()=>$(u.UNCHECKED),label:"æœªæ£€",icon:q})]})]}),j&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1.5 uppercase tracking-wider",children:"æ¼†é¢åšåº¦ (Î¼m)"}),e.jsx("input",{type:"number",min:"0",max:"3000",value:d,onChange:N=>{x(N.target.value),C(null)},placeholder:"è¯·è¾“å…¥æ¼†é¢åšåº¦",className:`w-full px-3 py-2 bg-gray-900 border border-gray-800 rounded-lg\r
              focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/50 \r
              outline-none transition-all text-sm text-gray-200 placeholder-gray-600`}),e.jsx("p",{className:"mt-1 text-[10px] text-gray-600",children:"æ­£å¸¸èŒƒå›´ï¼š80-150Î¼m"})]}),P&&e.jsxs("div",{className:"p-3 bg-gray-900/50 border border-gray-800 rounded-lg",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-2 uppercase tracking-wider",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(A,{className:"w-3 h-3"}),"é—®é¢˜ç…§ç‰‡"]})}),e.jsx(Je,{images:w,onImagesChange:f,maxImages:5})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1.5 uppercase tracking-wider",children:"å¤‡æ³¨è¯´æ˜"}),e.jsx("textarea",{value:m,onChange:N=>y(N.target.value),placeholder:"è¯·è¾“å…¥æ£€æµ‹å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰",maxLength:500,rows:3,className:`w-full px-3 py-2 bg-gray-900 border border-gray-800 rounded-lg\r
            focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/50 \r
            outline-none transition-all resize-none text-sm text-gray-200 placeholder-gray-600`}),e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsx("p",{className:"text-[10px] text-gray-600",children:"æœ€å¤š 500 å­—ç¬¦"}),e.jsxs("p",{className:`text-[10px] ${m.length>=500?"text-red-400":"text-gray-600"}`,children:[m.length,"/500"]})]})]}),_&&e.jsx("div",{className:"p-2.5 bg-red-500/10 border border-red-500/30 rounded-lg",children:e.jsx("p",{className:"text-xs text-red-400",children:_})}),e.jsxs("div",{className:"flex gap-2 pt-3 border-t border-gray-800",children:[e.jsxs("button",{onClick:E,className:`flex-1 flex items-center justify-center gap-1.5 px-3 py-2 \r
            bg-blue-600 hover:bg-blue-500 text-white rounded-lg \r
            transition-all duration-200 text-sm font-medium`,children:[e.jsx(Ee,{className:"w-4 h-4"}),"ä¿å­˜"]}),e.jsx("button",{onClick:i,className:`flex-1 px-3 py-2 bg-gray-800 hover:bg-gray-700 \r
            text-gray-300 rounded-lg transition-all duration-200 text-sm font-medium\r
            border border-gray-700`,children:"å–æ¶ˆ"})]})]})});ue.displayName="ResultForm";const te=({onClose:r})=>{const s=S(g=>g.currentType),t=S(g=>g.selectedPoint),i=S(g=>g.results),o=S(g=>g.setCurrentType),a=S(g=>g.selectPoint),d=S(g=>g.setResult),x=S(g=>g.resetResults),m=S(g=>g.getPointStatus),y=S(g=>g.getPointResult),w=S(g=>g.removeImage),f=S(g=>g.getStats()),[_,C]=l.useState(!1),j=l.useMemo(()=>D[s]||[],[s]),P=l.useMemo(()=>f.total===0?0:Math.round(f.checked/f.total*100),[f]),E=l.useCallback(g=>{o(g)},[o]),$=l.useCallback(g=>{a(g);const k=y(g);C(!k||k.status===u.UNCHECKED)},[a,y]),N=l.useCallback((g,k,n)=>{d(g,k,n),C(!1),r==null||r()},[d,r]),R=l.useCallback(()=>{a(null),C(!1)},[a]),b=l.useCallback(()=>{C(!0)},[]);l.useCallback((g,k)=>{w(g,k)},[w]);const v=l.useCallback(()=>{window.confirm("ç¡®å®šè¦é‡ç½®æ‰€æœ‰æ£€æµ‹ç»“æœå—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚")&&x()},[x]),I=l.useMemo(()=>t?j.find(g=>g.id===t):null,[t,j]),T=l.useMemo(()=>t?y(t):null,[t,y]);return e.jsxs("div",{className:"h-full bg-gray-900 rounded-xl border border-gray-800 shadow-xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex-none bg-gray-900/50 backdrop-blur-sm p-3 border-b border-gray-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4 text-blue-400"}),e.jsx("h2",{className:"text-sm font-bold text-gray-200",children:"æ£€æµ‹é¢æ¿"})]}),e.jsxs("button",{onClick:v,className:`flex items-center gap-1 px-2 py-1 text-xs text-gray-500 \r
              hover:text-red-400 hover:bg-red-500/10 rounded transition-all`,title:"é‡ç½®æ‰€æœ‰æ£€æµ‹ç»“æœ",children:[e.jsx($e,{className:"w-3 h-3"}),"é‡ç½®"]})]}),e.jsxs("div",{className:"flex gap-1 p-1 bg-gray-950 rounded-lg border border-gray-800",children:[e.jsxs("button",{onClick:()=>E("structure"),className:`
              flex-1 flex items-center justify-center gap-1.5 px-2 py-1.5 rounded-md text-xs font-medium transition-all
              ${s==="structure"?"bg-gray-800 text-blue-400 shadow-sm":"text-gray-500 hover:text-gray-300"}
            `,children:[e.jsx(Oe,{className:"w-3.5 h-3.5"}),"è½¦èº«ç»“æ„"]}),e.jsxs("button",{onClick:()=>E("paint"),className:`
              flex-1 flex items-center justify-center gap-1.5 px-2 py-1.5 rounded-md text-xs font-medium transition-all
              ${s==="paint"?"bg-gray-800 text-blue-400 shadow-sm":"text-gray-500 hover:text-gray-300"}
            `,children:[e.jsx(Pe,{className:"w-3.5 h-3.5"}),"è½¦èº«æ¼†é¢"]})]})]}),e.jsxs("div",{className:"flex-none p-3 grid grid-cols-3 gap-2 border-b border-gray-800",children:[e.jsx(B,{label:"å·²æ£€æµ‹",value:f.checked,colorClass:"text-blue-400"}),e.jsx(B,{label:"æ­£å¸¸",value:f.normal,colorClass:"text-green-400"}),e.jsx(B,{label:"å¼‚å¸¸",value:f.warning+f.error,colorClass:"text-red-400"})]}),e.jsxs("div",{className:"flex-none px-3 py-2 border-b border-gray-800",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-gray-500",children:"æ£€æµ‹è¿›åº¦"}),e.jsxs("span",{className:"font-medium text-gray-300",children:[P,"%"]})]}),e.jsx("div",{className:"h-1.5 bg-gray-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-cyan-400 rounded-full transition-all duration-300",style:{width:`${P}%`}})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3",children:I?_?e.jsx(ue,{point:I,result:T,onSave:N,onCancel:R}):e.jsx(ge,{point:I,result:T,onEdit:b}):e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("h3",{className:"text-xs font-medium text-gray-500 mb-2 flex items-center justify-between",children:[e.jsx("span",{children:s==="structure"?"ç»“æ„æ£€æµ‹éƒ¨ä½":"æ¼†é¢æ£€æµ‹éƒ¨ä½"}),e.jsxs("span",{className:"text-gray-600",children:["(",j.length,")"]})]}),j.map(g=>{const k=m(g.id),n=i[g.id];return e.jsx(de,{point:g,status:k,isSelected:!1,onClick:()=>$(g.id),hasPaintData:!!(n!=null&&n.paintThickness),result:n},g.id)})]})})]})};class Qe extends Y.Component{constructor(t){super(t);J(this,"handleRefresh",()=>{window.location.reload()});this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,i){console.error("ErrorBoundary caught error:",t,i)}render(){var t;return this.state.hasError?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full min-h-[400px] bg-gray-900/50 rounded-xl p-8 text-center border border-gray-800",children:[e.jsx("div",{className:"w-16 h-16 bg-red-500/10 rounded-full flex items-center justify-center mb-4 border border-red-500/20",children:e.jsx(Te,{className:"w-8 h-8 text-red-400"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-200 mb-2",children:"ç»„ä»¶åŠ è½½å‡ºé”™"}),e.jsx("p",{className:"text-sm text-gray-500 mb-6 max-w-xs",children:((t=this.state.error)==null?void 0:t.message)||"æœªçŸ¥é”™è¯¯"}),e.jsxs("button",{onClick:this.handleRefresh,className:`flex items-center gap-2 px-5 py-2.5 bg-blue-600 hover:bg-blue-500 \r
              text-white rounded-xl transition-all duration-200 font-medium\r
              shadow-lg shadow-blue-600/20`,children:[e.jsx(De,{className:"w-4 h-4"}),"åˆ·æ–°é¡µé¢"]})]}):this.props.children}}const L={[u.NORMAL]:{icon:G,color:"text-green-400",bg:"bg-green-500/10",border:"border-green-500/30",label:"æ­£å¸¸"},[u.WARNING]:{icon:K,color:"text-yellow-400",bg:"bg-yellow-500/10",border:"border-yellow-500/30",label:"å¼‚å¸¸"},[u.ERROR]:{icon:F,color:"text-red-400",bg:"bg-red-500/10",border:"border-red-500/30",label:"ä¸¥é‡"},[u.UNCHECKED]:{icon:null,color:"text-gray-400",bg:"bg-gray-500/10",border:"border-gray-500/30",label:"æœªæ£€"}},et=({isOpen:r,onClose:s})=>{var k;const t=S(n=>n.results),i=S(n=>n.removeImage),[o,a]=l.useState("grid"),[d,x]=l.useState("all"),[m,y]=l.useState("all"),[w,f]=l.useState(!1),[_,C]=l.useState([]),[j,P]=l.useState(0),[E,$]=l.useState(null),N=l.useMemo(()=>{const n=[];return Object.entries(t).forEach(([h,c])=>{if(c.images&&c.images.length>0){const p=[...D.structure,...D.paint].find(O=>O.id===h);p&&n.push({pointId:h,point:p,result:c,images:c.images,category:p.category,status:c.status})}}),n},[t]),R=l.useMemo(()=>N.filter(n=>{const h=d==="all"||n.status===d,c=m==="all"||n.category===m;return h&&c}),[N,d,m]),b=l.useMemo(()=>({total:N.reduce((n,h)=>n+h.images.length,0),points:N.length,structure:N.filter(n=>n.category==="structure").length,paint:N.filter(n=>n.category==="paint").length}),[N]),v=l.useCallback((n,h,c)=>{C(n),P(h),$(c),f(!0)},[]),I=l.useCallback(n=>{E&&(i(E,n),C(h=>h.filter((c,p)=>p!==n)))},[E,i]),T=l.useCallback(()=>{R.forEach((n,h)=>{n.images.forEach((c,p)=>{setTimeout(()=>{const O=document.createElement("a");O.href=c,O.download=`${n.point.name}_ç…§ç‰‡${p+1}.jpg`,document.body.appendChild(O),O.click(),document.body.removeChild(O)},(h*n.images.length+p)*200)})})},[R]),g=l.useMemo(()=>{const n=[];return R.forEach(h=>{h.images.forEach((c,p)=>{n.push({src:c,point:h.point,status:h.status,index:p,pointImages:h.images,pointId:h.pointId})})}),n},[R]);return r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"fixed inset-0 z-50 bg-gray-950 flex flex-col",children:[e.jsx("div",{className:"flex-none bg-gray-900 border-b border-gray-800 px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{className:"w-5 h-5 text-blue-400"}),e.jsx("h2",{className:"text-lg font-bold text-gray-200",children:"ç…§ç‰‡åº“"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",b.total," å¼ ç…§ç‰‡ / ",b.points," ä¸ªæ£€æµ‹ç‚¹)"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[b.total>0&&e.jsxs("button",{onClick:T,className:"flex items-center gap-1.5 px-3 py-1.5 text-sm bg-gray-800 hover:bg-gray-700 text-gray-300 rounded-lg transition-colors",children:[e.jsx(ne,{size:16}),"å¯¼å‡ºå…¨éƒ¨"]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-800 rounded-lg text-gray-400 transition-colors",children:e.jsx(H,{size:20})})]})]})}),e.jsx("div",{className:"flex-none bg-gray-900/50 border-b border-gray-800 px-4 py-3",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{size:14,className:"text-gray-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"çŠ¶æ€:"}),e.jsx("div",{className:"flex gap-1",children:[{key:"all",label:"å…¨éƒ¨"},{key:u.ERROR,label:"ä¸¥é‡",color:"text-red-400"},{key:u.WARNING,label:"å¼‚å¸¸",color:"text-yellow-400"},{key:u.NORMAL,label:"æ­£å¸¸",color:"text-green-400"}].map(({key:n,label:h,color:c})=>e.jsx("button",{onClick:()=>x(n),className:`
                      px-2.5 py-1 text-xs rounded-md transition-all
                      ${d===n?"bg-blue-600 text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700"}
                      ${c&&d!==n?c:""}
                    `,children:h},n))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"åˆ†ç±»:"}),e.jsx("div",{className:"flex gap-1",children:[{key:"all",label:"å…¨éƒ¨"},{key:"structure",label:"è½¦èº«ç»“æ„"},{key:"paint",label:"è½¦èº«æ¼†é¢"}].map(({key:n,label:h})=>e.jsx("button",{onClick:()=>y(n),className:`
                      px-2.5 py-1 text-xs rounded-md transition-all
                      ${m===n?"bg-blue-600 text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700"}
                    `,children:h},n))})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-auto bg-gray-800 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>a("grid"),className:`
                  p-1.5 rounded-md transition-colors
                  ${o==="grid"?"bg-gray-700 text-white":"text-gray-400 hover:text-gray-200"}
                `,title:"ç½‘æ ¼è§†å›¾",children:e.jsx(Me,{size:16})}),e.jsx("button",{onClick:()=>a("list"),className:`
                  p-1.5 rounded-md transition-colors
                  ${o==="list"?"bg-gray-700 text-white":"text-gray-400 hover:text-gray-200"}
                `,title:"åˆ—è¡¨è§†å›¾",children:e.jsx(Le,{size:16})})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:R.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-gray-500",children:[e.jsx(A,{size:64,className:"mb-4 opacity-30"}),e.jsx("p",{className:"text-lg",children:"æš‚æ— ç…§ç‰‡"}),e.jsx("p",{className:"text-sm mt-1",children:"è¯·åœ¨æ£€æµ‹æ—¶ä¸Šä¼ é—®é¢˜ç…§ç‰‡"})]}):o==="grid"?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3",children:g.map((n,h)=>{var p;const c=(p=L[n.status])==null?void 0:p.icon;return e.jsxs("div",{className:"group relative aspect-square rounded-lg overflow-hidden border border-gray-800 hover:border-gray-600 transition-all cursor-pointer",onClick:()=>v(n.pointImages,n.index,n.pointId),children:[e.jsx("img",{src:n.src,alt:`${n.point.name} ç…§ç‰‡${n.index+1}`,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}),c&&e.jsx("div",{className:`absolute top-2 right-2 p-1 rounded-full ${L[n.status].bg}`,children:e.jsx(c,{size:12,className:L[n.status].color})}),e.jsxs("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex flex-col justify-end p-2",children:[e.jsx("p",{className:"text-white text-xs font-medium truncate",children:n.point.name}),e.jsxs("p",{className:"text-gray-400 text-[10px]",children:["ç…§ç‰‡ ",n.index+1]})]})]},`${n.point.id}-${h}`)})}):e.jsx("div",{className:"space-y-3 max-w-4xl mx-auto",children:R.map(n=>{var c;(c=L[n.status])==null||c.icon;const h=L[n.status];return e.jsxs("div",{className:"bg-gray-900 border border-gray-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"font-medium text-gray-200",children:n.point.name}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded border ${h.bg} ${h.color} ${h.border}`,children:h.label}),e.jsx("span",{className:"text-xs text-gray-500",children:n.category==="structure"?"è½¦èº«ç»“æ„":"è½¦èº«æ¼†é¢"})]}),e.jsxs("button",{onClick:()=>v(n.images,0,n.pointId),className:"flex items-center gap-1 text-xs text-blue-400 hover:text-blue-300 transition-colors",children:[e.jsx(ze,{size:14}),"æŸ¥çœ‹å…¨éƒ¨",e.jsx(Z,{size:14})]})]}),e.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 gap-2",children:n.images.map((p,O)=>e.jsxs("button",{onClick:()=>v(n.images,O,n.pointId),className:"relative aspect-square rounded-lg overflow-hidden border border-gray-700 hover:border-blue-500 transition-colors group",children:[e.jsx("img",{src:p,alt:`ç…§ç‰‡ ${O+1}`,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors"})]},O))}),n.result.note&&e.jsxs("p",{className:"mt-3 text-sm text-gray-400 bg-gray-950/50 p-2 rounded",children:["å¤‡æ³¨: ",n.result.note]})]},n.pointId)})})})]}),e.jsx(oe,{images:_,initialIndex:j,isOpen:w,onClose:()=>f(!1),onDelete:I,title:E&&((k=D.structure.concat(D.paint).find(n=>n.id===E))==null?void 0:k.name)||""})]}):null},se=()=>{const[r,s]=l.useState(!1),t=()=>{document.fullscreenElement?document.exitFullscreen().then(()=>{s(!1)}).catch(()=>{}):document.documentElement.requestFullscreen().then(()=>{s(!0)}).catch(()=>{})};return Y.useEffect(()=>{const i=()=>{s(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",i),()=>document.removeEventListener("fullscreenchange",i)},[]),e.jsx("button",{onClick:t,className:"p-2 bg-gray-800/80 hover:bg-gray-700 rounded-lg transition-all duration-200 text-gray-400 hover:text-white border border-gray-700/50 active:scale-95",title:r?"é€€å‡ºå…¨å±":"å…¨å±æ˜¾ç¤º",children:r?e.jsx(He,{size:16}):e.jsx(Fe,{size:16})})},tt=({compact:r=!1})=>{const s=l.useMemo(()=>[{status:u.NORMAL,icon:G,label:"æ­£å¸¸",color:"text-green-400",bgColor:"bg-green-400/10",borderColor:"border-green-400/20"},{status:u.WARNING,icon:K,label:"å¼‚å¸¸",color:"text-yellow-400",bgColor:"bg-yellow-400/10",borderColor:"border-yellow-400/20"},{status:u.ERROR,icon:F,label:"ä¸¥é‡",color:"text-red-400",bgColor:"bg-red-400/10",borderColor:"border-red-400/20"},{status:u.UNCHECKED,icon:q,label:"æœªæ£€",color:"text-gray-400",bgColor:"bg-gray-400/10",borderColor:"border-gray-400/20"}],[]);return r?e.jsx("div",{className:"flex items-center gap-1.5",children:s.map(t=>e.jsxs("div",{className:`flex items-center gap-1 px-1.5 py-1 rounded ${t.bgColor} border ${t.borderColor}`,children:[e.jsx(t.icon,{size:10,className:t.color}),e.jsx("span",{className:"text-[10px] font-medium text-gray-300",children:t.label})]},t.status))}):e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:s.map(t=>e.jsxs("div",{className:`flex items-center gap-1.5 px-2 py-1 rounded-md ${t.bgColor} border ${t.borderColor}`,children:[e.jsx(t.icon,{size:12,className:t.color}),e.jsx("span",{className:"text-xs font-medium text-gray-300",children:t.label})]},t.status))})},re=({compact:r=!1})=>{const s=S(a=>a.results),t=l.useMemo(()=>{const a=Object.values(s),d=a.filter(y=>y!==u.UNCHECKED).length,x=a.includes(u.ERROR),m=a.includes(u.WARNING);return x?{message:r?"æœ‰é—®é¢˜":"æ£€æµ‹åˆ°ä¸¥é‡é—®é¢˜",color:"text-red-400",bg:"bg-red-400/10",border:"border-red-400/20",icon:F}:m?{message:r?"æœ‰å¼‚å¸¸":"æ£€æµ‹åˆ°éƒ¨åˆ†å¼‚å¸¸",color:"text-yellow-400",bg:"bg-yellow-400/10",border:"border-yellow-400/20",icon:K}:d>0?{message:r?"æ­£å¸¸":"è½¦è¾†æ£€æµ‹æ­£å¸¸",color:"text-green-400",bg:"bg-green-400/10",border:"border-green-400/20",icon:G}:{message:"ç­‰å¾…æ£€æµ‹",color:"text-gray-400",bg:"bg-gray-400/10",border:"border-gray-400/20",icon:q}},[s,r]),i=l.useMemo(()=>Object.values(s).filter(a=>a!==u.UNCHECKED).length,[s]),o=l.useMemo(()=>Object.keys(s).length,[s]);return e.jsxs("div",{className:`flex items-center gap-2 rounded-lg ${t.bg} border ${t.border} ${r?"px-2 py-1":"px-3 py-1.5"}`,children:[e.jsx(t.icon,{size:r?12:14,className:t.color}),e.jsx("span",{className:`font-medium ${t.color} ${r?"text-xs":"text-sm"}`,children:t.message}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",i,"/",o,")"]})]})},st=({isOpen:r,onClose:s,children:t})=>r?e.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:s}),e.jsxs("div",{className:"absolute right-0 top-0 bottom-0 w-[85vw] max-w-[400px] bg-gray-900 border-l border-gray-800 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-800",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-200",children:"æ£€æµ‹é¢æ¿"}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-800 rounded-lg transition-colors",children:e.jsx(H,{size:20,className:"text-gray-400"})})]}),e.jsx("div",{className:"p-4 h-[calc(100%-60px)] overflow-y-auto",children:t})]})]}):null,rt=()=>{const r=S(a=>a.selectPoint),[s,t]=l.useState(!1),[i,o]=l.useState(!1);return e.jsxs("div",{className:"h-screen bg-gray-950 text-white flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex-none bg-gray-900/90 backdrop-blur-md border-b border-gray-800 px-3 py-2 lg:px-4 lg:py-3",children:[e.jsxs("div",{className:"hidden lg:flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent",children:"è½¦è¾†æ£€æµ‹å¯è§†åŒ–ç³»ç»Ÿ"}),e.jsx("p",{className:"text-xs text-gray-500",children:"äºŒæ‰‹è½¦äº‹æ•…æ£€æµ‹ Â· è½¦èº«ç»“æ„ Â· æ¼†é¢æ£€æµ‹"})]}),e.jsx("div",{className:"h-8 w-px bg-gray-800"}),e.jsx(re,{})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>o(!0),className:"flex items-center gap-1.5 px-3 py-1.5 bg-gray-800 hover:bg-gray-700 text-gray-300 rounded-lg transition-colors text-sm",title:"æŸ¥çœ‹ç…§ç‰‡åº“",children:[e.jsx(A,{size:16}),"ç…§ç‰‡åº“"]}),e.jsx(tt,{}),e.jsx(se,{})]})]}),e.jsxs("div",{className:"flex lg:hidden items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-base font-bold bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent",children:"è½¦è¾†æ£€æµ‹ç³»ç»Ÿ"}),e.jsx(re,{compact:!0})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>o(!0),className:"p-2 bg-gray-800 hover:bg-gray-700 text-gray-300 rounded-lg transition-colors",title:"ç…§ç‰‡åº“",children:e.jsx(A,{size:18})}),e.jsxs("button",{onClick:()=>t(!0),className:"flex items-center gap-1.5 px-3 py-1.5 bg-blue-600 hover:bg-blue-500 rounded-lg transition-colors text-sm font-medium",children:[e.jsx(Ue,{size:14}),"æ£€æµ‹é¢æ¿"]}),e.jsx(se,{})]})]})]}),e.jsx("main",{className:"flex-1 p-2 lg:p-4 overflow-hidden",children:e.jsxs("div",{className:"h-full flex flex-col lg:grid lg:grid-cols-12 gap-2 lg:gap-4",children:[e.jsx("div",{className:"flex-1 lg:col-span-8 min-h-0",children:e.jsxs("div",{className:"h-full bg-gray-900 rounded-xl border border-gray-800 shadow-xl overflow-hidden flex flex-col",children:[e.jsx("div",{className:"flex-1 relative min-h-0",children:e.jsx(Qe,{children:e.jsx(Xe,{onPointClick:a=>{r(a),window.innerWidth<1024&&t(!0)}})})}),e.jsxs("div",{className:"flex-none px-3 py-2 lg:px-4 lg:py-2 bg-gray-950/80 border-t border-gray-800 flex items-center justify-center gap-3 lg:gap-6 text-[10px] lg:text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"hidden sm:inline",children:"ğŸ–±"}),e.jsx("span",{className:"sm:hidden",children:"ğŸ‘†"}),"æ‹–åŠ¨æ—‹è½¬"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"hidden sm:inline",children:"âš²"}),e.jsx("span",{className:"sm:hidden",children:"ğŸ¤"}),"ç¼©æ”¾"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"hidden sm:inline",children:"ğŸ‘†"}),e.jsx("span",{className:"sm:hidden",children:"ğŸ‘†"}),"ç‚¹å‡»æ ‡è®°"]})]})]})}),e.jsx("div",{className:"hidden lg:block lg:col-span-4 h-full min-h-0",children:e.jsx(te,{})})]})}),e.jsx(st,{isOpen:s,onClose:()=>t(!1),children:e.jsx(te,{onClose:()=>t(!1)})}),e.jsx(et,{isOpen:i,onClose:()=>o(!1)})]})};je.createRoot(document.getElementById("root")).render(e.jsx(Y.StrictMode,{children:e.jsx(rt,{})}));
